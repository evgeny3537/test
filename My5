# --- НАСТРОЙКИ ---
# Укажите IP или Имя сервера, где лежит ваша папка
$ServerAddress = "192.168.1.X"
# Интервал проверки (в секундах)
$Interval = 60
# -----------------

while ($true) {
    try {
        # 1. Формируем путь к скрытому административному ресурсу IPC$
        # IPC (Inter-Process Communication) отвечает за аутентификацию
        $IpcPath = "\\$ServerAddress\IPC$"

        # 2. Сначала удаляем старое подключение к IPC (если оно зависло), 
        # чтобы гарантировать новый "рукопожатие" (handshake).
        # 2>&1 | Out-Null гасит все сообщения об ошибках (например, если подключения не было)
        net use $IpcPath /delete /y 2>&1 | Out-Null

        # 3. Создаем новое "пустое" подключение.
        # Это заставляет Windows заново отправить тикет безопасности на сервер.
        # Если у вас домен или сохраненные пароли, достаточно команды без пароля.
        # Если нужны конкретные логин/пароль, раскомментируйте строку ниже в блоке else.
        
        $Process = Start-Process -FilePath "net.exe" -ArgumentList "use $IpcPath" -WindowStyle Hidden -PassThru -Wait
        
        # АЛЬТЕРНАТИВА: Если нужна явная авторизация (раскомментируйте и заполните, если вариант выше не сработал):
        # Start-Process "net.exe" -ArgumentList "use $IpcPath ваш_пароль /user:ДОМЕН\ваш_логин" -WindowStyle Hidden -Wait

        # 4. (Опционально) Можно "дернуть" диск Z, чтобы проверить статус,
        # но само подключение к IPC$ уже должно было оживить сессию.
        if (Test-Path "Z:\") {
            # Ничего не делаем, доступ есть
        }
    }
    catch {
        # Ловим любые непредвиденные ошибки, чтобы цикл не упал
    }

    # Ждем перед следующим кругом
    Start-Sleep -Seconds $Interval
}
